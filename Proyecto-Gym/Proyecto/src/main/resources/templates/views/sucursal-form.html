<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Nueva Sucursal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
  <div class="card mx-auto" style="max-width: 700px;">
    <div class="card-header text-center">
      <h3>Nueva Sucursal</h3>
    </div>
    <div class="card-body">

      <form th:action="@{/sucursal/crear}" method="post"
            th:object="${sucursal}" enctype="application/x-www-form-urlencoded">

        <!-- Nombre -->
        <div class="mb-3">
          <label class="form-label">Nombre Sucursal</label>
          <input type="text" th:field="*{nombre}" class="form-control" required>
        </div>

        <!-- Empresa -->
        <div class="mb-3">
          <label class="form-label">Empresa</label>
          <select th:field="*{empresa.id}" class="form-select" required>
            <option value="">-- Seleccione empresa --</option>
            <option th:each="emp : ${empresas}" th:value="${emp.id}" th:text="${emp.nombre}"></option>
          </select>
        </div>
        <!-- Direcci√≥n existente -->
        <div class="mb-3">
          <label for="direccion" class="form-label">Direcci√≥n existente</label>
          <select th:field="*{direccion.id}" class="form-select">
            <option value="">-- Seleccione direcci√≥n existente --</option>
            <option th:each="d : ${direcciones}" th:value="${d.id}"
                    th:text="${d.calle + ' ' + d.numeracion}"></option>
          </select>
        </div>

        <!-- Flag para indicar nueva direcci√≥n -->
        <input type="hidden" id="crearNuevaDireccion" name="crearNuevaDireccion" value="false">

        <!-- Bot√≥n para nueva direcci√≥n -->
        <button type="button" class="btn btn-outline-primary mb-3" id="toggleNuevaDir">
          + Nueva Direcci√≥n
        </button>

        <!-- üü¢ Formulario de nueva direcci√≥n -->
        <div id="nuevaDireccionForm" class="border rounded p-3" style="display:none;"
             th:object="${nuevaDireccion}">
          <h5>Nueva Direcci√≥n</h5>

          <!-- Pa√≠s -->
          <div class="mb-3">
            <label class="form-label">Pa√≠s *</label>
            <select th:field="*{localidad.departamento.provincia.pais.id}" class="form-select" required>
              <option value="">-- Seleccione Pa√≠s --</option>
              <option th:each="p : ${paises}" th:value="${p.id}" th:text="${p.nombre}"></option>
            </select>
          </div>

          <!-- Provincia -->
          <div class="mb-3">
            <label class="form-label">Provincia *</label>
            <select th:field="*{localidad.departamento.provincia.id}" class="form-select" required>
              <option value="">-- Seleccione Provincia --</option>
              <option th:each="prov : ${provincias}" th:value="${prov.id}" th:text="${prov.nombre}"></option>
            </select>
          </div>

          <!-- Departamento -->
          <div class="mb-3">
            <label class="form-label">Departamento *</label>
            <select th:field="*{localidad.departamento.id}" class="form-select" required>
              <option value="">-- Seleccione Departamento --</option>
              <option th:each="dep : ${departamentos}" th:value="${dep.id}" th:text="${dep.nombre}"></option>
            </select>
          </div>

          <!-- Localidad -->
          <div class="mb-3">
            <label class="form-label">Localidad *</label>
            <select th:field="*{localidad.id}" class="form-select" required>
              <option value="">-- Seleccione Localidad --</option>
              <option th:each="loc : ${localidades}" th:value="${loc.id}" th:text="${loc.nombre}"></option>
            </select>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label>Calle *</label>
              <input type="text" th:field="*{calle}" class="form-control" required>
            </div>
            <div class="col-md-3 mb-3">
              <label>N√∫mero</label>
              <input type="text" th:field="*{numeracion}" class="form-control">
            </div>
            <div class="col-md-3 mb-3">
              <label>Barrio</label>
              <input type="text" th:field="*{barrio}" class="form-control">
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <label class="form-label">Casa/Depto</label>
            <input type="text" class="form-control" name="casaDepartamento" th:field="*{casaDepartamento}" placeholder="Ej: 4B">
          </div>
          <div class="col-md-3 mb-3">
            <label class="form-label">Manzana/Piso</label>
            <input type="text" class="form-control" name="manzanaPiso" th:field="*{manzanaPiso}" placeholder="Ej: Mz 5 / 2¬∞">
          </div>

          <div class="mb-3">
            <label>Referencia</label>
            <input type="text" th:field="*{referencia}" class="form-control">
          </div>
        </div>

        <div class="d-flex justify-content-between mt-4">
          <a th:href="@{/sucursal}" class="btn btn-secondary">Cancelar</a>
          <button type="submit" class="btn btn-primary">Guardar</button>
        </div>
      </form>

    </div>
  </div>
</div>

<script>
  const toggleBtn = document.getElementById('toggleNuevaDir');
  const formNueva = document.getElementById('nuevaDireccionForm');
  const flag = document.getElementById('crearNuevaDireccion');

  // Tomamos todos los campos que tienen "required" en el bloque de nueva direcci√≥n
  const camposNuevaDireccion = formNueva.querySelectorAll('[required]');

  // Desactiva validaci√≥n de los campos ocultos
  function desactivarCampos() {
    camposNuevaDireccion.forEach(campo => campo.removeAttribute('required'));
  }

  // Activa validaci√≥n de los campos cuando el bloque se muestra
  function activarCampos() {
    camposNuevaDireccion.forEach(campo => campo.setAttribute('required', 'required'));
  }

  // Al cargar la p√°gina, el bloque est√° oculto ‚Üí desactivamos sus required
  desactivarCampos();

  toggleBtn.addEventListener('click', () => {
    if (formNueva.style.display === 'none') {
      // Mostrar bloque de nueva direcci√≥n
      formNueva.style.display = 'block';
      flag.value = 'true';
      activarCampos();  // activamos required
    } else {
      // Ocultar bloque de nueva direcci√≥n
      formNueva.style.display = 'none';
      flag.value = 'false';
      desactivarCampos(); // desactivamos required
    }
  });
</script>



</body>
</html>
