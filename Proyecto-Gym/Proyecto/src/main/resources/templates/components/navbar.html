<nav th:fragment="nav_bar" class="navigation navbar navbar-expand-md navbar-light bg-white py-2" style="position: relative; z-index: 1060; border-bottom: 1px solid #e9ecef;" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
  <div class="container-fluid">

    <!-- Brand -->
    <a class="navbar-brand fw-bold" th:href="@{/}">Gimnasio Pro</a>

    <!-- Toggler -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsMain" aria-controls="navbarsMain" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Navbar content -->
    <div class="collapse navbar-collapse" id="navbarsMain">
      <ul class="navbar-nav me-auto mb-2 mb-md-0">

        <!-- ADMIN -->
        <li class="nav-item dropdown" sec:authorize="hasRole('ROLE_ADMIN')">
          <a class="nav-link dropdown-toggle" href="#" id="adminDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Administraci贸n</a>
          <ul class="dropdown-menu" aria-labelledby="adminDropdown">
            <li><a class="dropdown-item" th:href="@{/empleados}">Gestionar Empleados</a></li>
            <li><a class="dropdown-item" th:href="@{/socios}">Gestionar Socios</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" th:href="@{/mensaje}">Enviar Mensajes</a></li>
            <li><a class="dropdown-item" th:href="@{/valor-cuota}">Gestionar Valores Cuota</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" th:href="@{/empresas}">Gestionar Empresas</a></li>
            <li><a class="dropdown-item" th:href="@{/sucursales}">Gestionar Sucursales</a></li>
          </ul>
        </li>

        <!-- EMPLEADO -->
        <li class="nav-item dropdown" sec:authorize="hasRole('ROLE_EMPLEADO')">
          <a class="nav-link dropdown-toggle" href="#" id="empleadoDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Empleado</a>
          <ul class="dropdown-menu" aria-labelledby="empleadoDropdown">
            <li><a class="dropdown-item" th:href="@{/socios}">Ver Socios</a></li>
            <li><a class="dropdown-item" th:href="@{/mensaje}">Enviar Mensajes</a></li>
            <li><a class="dropdown-item" th:href="@{/rutina/mis_rutinas}">Mis Rutinas</a></li>
          </ul>
        </li>

        <!-- SOCIO -->
        <li class="nav-item dropdown" sec:authorize="hasRole('ROLE_SOCIO')">
          <a class="nav-link dropdown-toggle" href="#" id="socioDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Socio</a>
          <ul class="dropdown-menu" aria-labelledby="socioDropdown">
            <li><a class="dropdown-item" th:href="@{/rutina/mis_rutinas}">Mis Rutinas</a></li>
            <li><a class="dropdown-item" th:href="@{/cuotas}">Mis Cuotas</a></li>
            <li><a class="dropdown-item" th:href="@{/pagos}">Mis Pagos</a></li>
          </ul>
        </li>

        <!-- Mensajes (para autenticados) -->
        <li class="nav-item" sec:authorize="isAuthenticated()">
          <a class="nav-link" th:href="@{/mensajes}">Mensajes <span class="badge bg-danger ms-1" sec:authorize="isAuthenticated()" th:if="${mensajesNoLeidos > 0}" th:text="${mensajesNoLeidos}">0</span></a>
        </li>

      </ul>

      <!-- Search form -->
      <form class="d-flex me-3" sec:authorize="isAuthenticated()" th:action="@{/buscar}" method="get">
        <input class="form-control me-2" type="search" name="q" placeholder="Buscar..." aria-label="Buscar" style="min-width: 180px;"/>
        <button class="btn btn-outline-secondary" type="submit">Buscar</button>
      </form>

      <!-- User menu -->
      <ul class="navbar-nav">
        <li class="nav-item dropdown" sec:authorize="isAuthenticated()">
          <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <span sec:authentication="name">Usuario</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
            <li class="dropdown-header">
              <strong sec:authentication="name">Usuario</strong>
              <div class="small text-muted">Rol: <span sec:authorize="hasRole('ROLE_ADMIN')">ADMIN</span><span sec:authorize="hasRole('ROLE_EMPLEADO')"> EMPLEADO</span><span sec:authorize="hasRole('ROLE_SOCIO')"> SOCIO</span></div>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" th:href="@{/perfil}">Mi Perfil</a></li>
            <li><a class="dropdown-item" th:href="@{/configuracion}">Configuraci贸n</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" th:href="@{/logout}">Cerrar Sesi贸n</a></li>
          </ul>
        </li>

        <!-- Links for unauthenticated users -->
        <li class="nav-item" sec:authorize="!isAuthenticated()">
          <a class="nav-link" th:href="@{/registro}">Registrarse</a>
        </li>
        <li class="nav-item" sec:authorize="!isAuthenticated()">
          <a class="nav-link btn btn-outline-secondary ms-2 px-3" th:href="@{/login}">Iniciar Sesi贸n</a>
        </li>
      </ul>

    </div>
  </div>
</nav>
