<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
	<head th:replace="~{components/header :: head}"></head>
	<body>

		<div th:replace="~{components/admin_subnav :: admin_nav}"></div>

		<div class="container py-5" th:with="entityName='Geografía', items=${items}">
			<div class="d-flex justify-content-between align-items-center mb-4">
				<h2>ABM Geografía (Provincias / Localidades)</h2>
				<div>
					<button class="btn btn-success" id="btnNew">Nuevo Elemento</button>
					<a class="btn btn-secondary" th:href="@{/portal/admin}">Volver al portal</a>
				</div>
			</div>

			<div class="table-responsive">
				<table class="table table-striped" id="abmTable">
					<thead>
						<tr>
							<th>#</th>
							<th>Tipo</th>
							<th>Nombre</th>
							<th>Relacionado</th>
							<th>Eliminado</th>
							<th>Acciones</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="item : ${items}">
							<td th:text="${item.id}">id</td>
							<td th:text="${item.tipo}">Provincia</td>
							<td th:text="${item.nombre}">Nombre</td>
							<td th:text="${item.relacion != null ? item.relacion.nombre : '-'}">Relacionado</td>
							<td><span th:text="${item.eliminado} ? 'Sí' : 'No'">No</span></td>
							<td>
								<button class="btn btn-sm btn-primary btn-edit" type="button"
												th:data-id="${item.id}" th:data-tipo="${item.tipo}" th:data-nombre="${item.nombre}" th:data-relacion="${item.relacion != null ? item.relacion.id : ''}" th:data-eliminado="${item.eliminado}">Editar</button>
								<button class="btn btn-sm btn-danger btn-delete" type="button" th:data-id="${item.id}">Eliminar</button>
							</td>
						</tr>
						<tr th:if="${items == null or #lists.isEmpty(items)}">
							<td colspan="6" class="text-center">No hay elementos geográficos cargados.</td>
						</tr>
					</tbody>
				</table>
			</div>

			<!-- Modal: Geografía (generic) -->
			<div class="modal fade" id="abmModal" tabindex="-1" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="abmModalTitle">Nuevo Elemento</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<form id="abmForm">
								<input type="hidden" id="itemId" name="id" />
								<div class="mb-3">
									<label class="form-label">Tipo (pais|provincia|localidad)</label>
									<input id="itemTipo" name="tipo" class="form-control" />
								</div>
								<div class="mb-3">
									<label class="form-label">Nombre</label>
									<input id="itemNombre" name="nombre" class="form-control" />
								</div>
								<div class="mb-3">
									<label class="form-label">Relacionado (ID) — e.g., pais para provincia</label>
									<input id="itemRelacion" name="relacionId" class="form-control" />
								</div>
								<div class="form-check mb-3">
									<input class="form-check-input" type="checkbox" id="itemEliminado" name="eliminado" />
									<label class="form-check-label" for="itemEliminado">Eliminado</label>
								</div>
							</form>
						</div>
						<div class="modal-footer">
							<button type="button" id="cancelItem" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
							<button type="button" class="btn btn-primary" id="saveItem">Guardar</button>
						</div>
					</div>
				</div>
			</div>

		</div>

		<div th:replace="~{components/header :: scripts}"></div>

		<script>
			(function(){
				var modalEl = document.getElementById('abmModal');
				var abmModal = modalEl ? new bootstrap.Modal(modalEl) : null;
				function clearForm(){ document.getElementById('itemId').value=''; document.getElementById('itemTipo').value=''; document.getElementById('itemNombre').value=''; document.getElementById('itemRelacion').value=''; document.getElementById('itemEliminado').checked=false; }
				document.getElementById('btnNew').addEventListener('click', function(){ clearForm(); document.getElementById('abmModalTitle').textContent='Nuevo Elemento'; abmModal.show(); });
				document.querySelectorAll('.btn-edit').forEach(function(btn){ btn.addEventListener('click', function(){ document.getElementById('itemId').value=btn.getAttribute('data-id'); document.getElementById('itemTipo').value=btn.getAttribute('data-tipo'); document.getElementById('itemNombre').value=btn.getAttribute('data-nombre'); document.getElementById('itemRelacion').value=btn.getAttribute('data-relacion'); document.getElementById('itemEliminado').checked = btn.getAttribute('data-eliminado') === 'true'; document.getElementById('abmModalTitle').textContent='Editar Elemento'; abmModal.show(); }); });
				document.querySelectorAll('.btn-delete').forEach(function(btn){ btn.addEventListener('click', function(){ var id=btn.getAttribute('data-id'); if(confirm('¿Eliminar elemento #'+id+'?')) btn.closest('tr').remove(); }); });
				document.getElementById('saveItem').addEventListener('click', function(){ abmModal.hide(); }); var cancelBtn = document.getElementById('cancelItem'); if(cancelBtn) cancelBtn.addEventListener('click', function(){ if(abmModal) abmModal.hide(); });
			})();
		</script>

	</body>
</html>
