<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{components/header :: head}"></head>
<body>

  <div th:replace="~{components/admin_subnav :: admin_nav}"></div>

  <div class="container py-5">
    <h2 th:text="${rutina != null} ? 'Editar Rutina' : 'Nueva Rutina'"></h2>

    <form th:action="@{/rutina/admin/alta}" method="post">
      <input type="hidden" name="id" th:value="${rutina != null} ? ${rutina.id} : ''" />

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Fecha Inicio</label>
          <input id="itemFechaInicio" name="fechaInicio" class="form-control" type="date" th:value="${rutina != null} ? ${rutina.fechaInicio} : ''" />
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">Fecha Fin</label>
          <input id="itemFechaFin" name="fechaFin" class="form-control" type="date" th:value="${rutina != null} ? ${rutina.fechaFin} : ''" />
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">Socio</label>
        <select id="itemSocio" name="numeroSocio" class="form-select" required>
          <option value="" disabled selected>Seleccionar socio</option>
          <option th:each="s : ${socios}" th:value="${s.numeroSocio}" th:text="${s.nombre + ' ' + s.apellido + ' (Nro: ' + s.numeroSocio + ')'}" th:selected="${rutina != null and rutina.socio != null and rutina.socio.numeroSocio == s.numeroSocio}"></option>
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Profesor</label>
        <select id="itemProfesor" name="idProfesor" class="form-select" required>
          <option value="" disabled selected>Seleccionar profesor</option>
          <option th:each="p : ${profesores}" th:value="${p.id}" th:text="${p.nombre + ' ' + p.apellido}" th:selected="${rutina != null and rutina.profesor != null and rutina.profesor.id == p.id}"></option>
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Estado</label>
        <input id="itemEstado" name="estado" class="form-control" th:value="${rutina != null} ? ${rutina.estado} : ''" />
      </div>

      <div class="mb-3">
        <label class="form-label">Detalle de actividades</label>
        <div id="detallesAdmin">
          <div class="d-flex gap-2 mb-2" th:if="${rutina == null}">
            <input type="text" name="actividades" placeholder="Actividad" class="form-control" />
            <input type="date" name="fechas" class="form-control" />
          </div>
          <div th:if="${rutina != null}" th:each="d : ${rutina.detalleRutina}" class="d-flex gap-2 mb-2">
            <input type="text" name="actividades" th:value="${d.actividad}" placeholder="Actividad" class="form-control" />
            <input type="date" name="fechas" th:value="${d.fecha}" class="form-control" />
          </div>
        </div>
        <button type="button" class="btn btn-sm btn-secondary mt-2" id="addDetalle">+ Agregar actividad</button>
      </div>

      <div class="d-flex gap-2">
        <a th:href="@{/portal/admin/rutinas}" class="btn btn-secondary">Cancelar</a>
        <button type="submit" class="btn btn-primary">Guardar rutina</button>
      </div>
    </form>
  </div>

  <div th:replace="~{components/header :: scripts}"></div>

  <script>
    (function(){
      var addDetalleBtn = document.getElementById('addDetalle');
      if(addDetalleBtn){
        addDetalleBtn.addEventListener('click', function(){
          var wrapper = document.createElement('div');
          wrapper.className = 'd-flex gap-2 mb-2';
          wrapper.innerHTML = '<input type="text" name="actividades" placeholder="Actividad" class="form-control" />\n            <input type="date" name="fechas" class="form-control" />';
          document.getElementById('detallesAdmin').appendChild(wrapper);
        });
      }
    })();
  </script>

</body>
</html>
